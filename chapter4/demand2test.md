# 从需求到测试

开发任何系统前我们都要先对需求进行分析，使得她变得更小，更具体。

## 分解需求

你可能想把现有需求划分成“需要做的事”——也就是任务——完成了这些任务，也就满足了需求。这次我们换种方式，将需求需求分解为一系列的测试，通过了所有测试也就满足了所有需求。  
比如我们正在开发一套邮件模板系统。“模板中没有变量的时候，我们就将模板原封发出”，“在祝贺信中，表示收件人名的变量应该替换为每个收件人的名字”。不久你就会有很多这样的测试，合起来就不是在测试系统中的一小部分啦。最终你将测试将会覆盖产品的绝大部分，甚至是全部的行为和功能。

为了说明任务和测试之间的区别，我们通过将邮件系统分解成任务和测试进行对比。对比左边的任务和右边的测试，很明显右侧更能表明软件拥有的功能。

| 把模板子系统分解为任务 | 把模板子系统分解为测试 |
| :---: | :---: |
| 写一个正则表单式确定模板中的变量 | 没有变量的模板渲染前后不变 |
| 实现一个表达式模板解析器 | 含有一个变量的模板渲染后，应该变量替换为相应值 |
| 实现一个模板引擎，内部实现使用模板解析器 | 含有多个变量的模板渲染后，相应变量替换为相应值 |

将需求转换为测试要比任务好的多，任务只提示我们下一步该做什么，而没有清晰的“完成”的定义。

## 什么样的测试是好的测试

把需求分解成测试的角度看，有亮点尤为重要：

* 好的测试是原子化的
* 好的测试是独立的

也就是说好的测试必须能够集中的原子化的验证待测行为的一小部分。此外测试之间也应该是相互隔离的，测试不应该对之前的测试结果做任何假设。若能够依照原子性准则进行测试编写，我们就能将注意力集中到当前工作中了。这样就能保证稳健的走好每一步，从而构建出功能齐全，运行良好的完整系统。

## 依照测试列表工作

在实现功能的每一步中，我们并不是随意写一个测试就进行开发。挑选测试使用一定技巧的。

有了一个测试列表我们就可以开始进行代码编写了，让测试一个个通过。首先我们挑选一个测试，通常是我们认为最容易通过的那个，或者花最少功夫就能取得进展的那个。这时我们要忘记其他测试，只专注于当前测试。在挑选完测试后我们就要编写测试代码了。

## 意图编程

在写测试代码前我们要想象待测代码已经存在了。我们可以站在当前测试的角度来设想产品代码的完美形态。我们在写测试的时候想象代码是那般的易用，在写测试的工作也会变得轻松。

